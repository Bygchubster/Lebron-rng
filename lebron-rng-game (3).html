<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeBron RNG: King's Gacha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;700&display=swap');
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }
        .font-bungee {
            font-family: 'Bungee', cursive;
        }
        .text-shadow-glow {
            text-shadow: 0 0 10px rgba(249, 115, 22, 0.5), 0 0 20px rgba(249, 115, 22, 0.3);
        }
        .drop-shadow-glow {
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.4));
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
        
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-8px) rotate(-1.5deg); }
          50% { transform: translateX(8px) rotate(1.5deg); }
          75% { transform: translateX(-4px) rotate(-0.5deg); }
        }
        .animate-shake {
          animation: shake 0.15s infinite cubic-bezier(0.36, 0.07, 0.19, 0.97);
        }

        @keyframes flash {
          0%, 100% { opacity: 0; }
          50% { opacity: 0.6; }
        }
        .animate-flash {
          animation: flash 0.3s infinite;
        }

        @keyframes god-reveal {
          0% { transform: scale(0.3) rotate(-45deg); opacity: 0; filter: brightness(10) blur(20px); }
          60% { transform: scale(1.2) rotate(10deg); opacity: 1; filter: brightness(3) blur(0px); }
          100% { transform: scale(1) rotate(0deg); opacity: 1; filter: brightness(1) blur(0px); }
        }
        .animate-god-reveal {
          animation: god-reveal 2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes flare {
          0% { left: -150%; }
          100% { left: 150%; }
        }
        .animate-flare {
          animation: flare 1.5s infinite linear;
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="module">
        import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';

        // ==================== TYPES ====================
        const Rarity = {
          COMMON: 'Common',
          UNCOMMON: 'Uncommon',
          RARE: 'Rare',
          EPIC: 'Epic',
          LEGENDARY: 'Legendary',
          MYTHIC: 'Mythic',
          CELESTIAL: 'Celestial',
          DIVINE: 'Divine',
          GOAT: 'GOAT'
        };

        // ==================== CONSTANTS ====================
        const RARITY_CONFIG = {
          [Rarity.COMMON]: { color: 'text-gray-400', glow: 'shadow-gray-500/50', bg: 'bg-gray-800' },
          [Rarity.UNCOMMON]: { color: 'text-green-400', glow: 'shadow-green-500/50', bg: 'bg-green-900/40' },
          [Rarity.RARE]: { color: 'text-blue-400', glow: 'shadow-blue-500/50', bg: 'bg-blue-900/40' },
          [Rarity.EPIC]: { color: 'text-purple-400', glow: 'shadow-purple-500/50', bg: 'bg-purple-900/40' },
          [Rarity.LEGENDARY]: { color: 'text-yellow-400', glow: 'shadow-yellow-500/50', bg: 'bg-yellow-900/40' },
          [Rarity.MYTHIC]: { color: 'text-red-500', glow: 'shadow-red-500/50', bg: 'bg-red-900/40' },
          [Rarity.CELESTIAL]: { color: 'text-cyan-400', glow: 'shadow-cyan-500/50', bg: 'bg-cyan-900/40' },
          [Rarity.DIVINE]: { color: 'text-pink-400', glow: 'shadow-pink-500/50', bg: 'bg-pink-900/40' },
          [Rarity.GOAT]: { color: 'text-white font-bold tracking-widest', glow: 'shadow-white/80', bg: 'bg-gradient-to-r from-orange-500 via-white to-orange-500' },
        };

        const LEBRON_IMAGE = 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/LeBron_James_crop.jpg/800px-LeBron_James_crop.jpg';

        const PLAYERS = [
          { id: 'lb1', name: 'Baby LeBron', rarity: Rarity.COMMON, odds: 2, color: 'text-gray-400', glowColor: 'gray', image: LEBRON_IMAGE },
          { id: 'lb2', name: 'Draft Day LeBron', rarity: Rarity.COMMON, odds: 5, color: 'text-gray-400', glowColor: 'gray', image: LEBRON_IMAGE },
          { id: 'lb3', name: 'High School LeBron', rarity: Rarity.UNCOMMON, odds: 15, color: 'text-green-400', glowColor: 'green', image: LEBRON_IMAGE },
          { id: 'lb4', name: 'Masked LeBron', rarity: Rarity.UNCOMMON, odds: 25, color: 'text-green-400', glowColor: 'green', image: LEBRON_IMAGE },
          { id: 'lb5', name: 'Taco Tuesday LeBron', rarity: Rarity.RARE, odds: 50, color: 'text-blue-400', glowColor: 'blue', image: LEBRON_IMAGE },
          { id: 'lb6', name: 'Headband LeBron', rarity: Rarity.RARE, odds: 100, color: 'text-blue-400', glowColor: 'blue', image: LEBRON_IMAGE },
          { id: 'lb7', name: 'Miami Heat LeBron', rarity: Rarity.EPIC, odds: 250, color: 'text-purple-400', glowColor: 'purple', image: LEBRON_IMAGE },
          { id: 'lb8', name: 'Space Jam LeBron', rarity: Rarity.EPIC, odds: 500, color: 'text-purple-400', glowColor: 'purple', image: LEBRON_IMAGE },
          { id: 'lb9', name: 'The Silencer LeBron', rarity: Rarity.LEGENDARY, odds: 1000, color: 'text-yellow-400', glowColor: 'yellow', image: LEBRON_IMAGE },
          { id: 'lb10', name: 'King James', rarity: Rarity.LEGENDARY, odds: 2500, color: 'text-yellow-400', glowColor: 'yellow', image: LEBRON_IMAGE },
          { id: 'lb11', name: 'LePookie Bear', rarity: Rarity.LEGENDARY, odds: 5000, color: 'text-yellow-400', glowColor: 'yellow', image: LEBRON_IMAGE },
          { id: 'lb12', name: 'Skibidi LeBron', rarity: Rarity.MYTHIC, odds: 10000, color: 'text-red-500', glowColor: 'red', image: LEBRON_IMAGE },
          { id: 'lb13', name: 'You Are My Sunshine LeBron', rarity: Rarity.MYTHIC, odds: 25000, color: 'text-red-500', glowColor: 'red', image: LEBRON_IMAGE },
          { id: 'lb14', name: 'Mewing LeBron', rarity: Rarity.MYTHIC, odds: 50000, color: 'text-red-500', glowColor: 'red', image: LEBRON_IMAGE },
          { id: 'lb15', name: 'Cybernetic LeBron 3000', rarity: Rarity.CELESTIAL, odds: 100000, color: 'text-cyan-400', glowColor: 'cyan', image: LEBRON_IMAGE },
          { id: 'lb16', name: 'The Chosen One (Ascended)', rarity: Rarity.DIVINE, odds: 500000, color: 'text-pink-400', glowColor: 'pink', image: LEBRON_IMAGE },
          { id: 'lb17', name: 'Gold LeBron (Statue)', rarity: Rarity.GOAT, odds: 1000000, color: 'text-white', glowColor: 'white', image: LEBRON_IMAGE },
          { id: 'lb18', name: 'Literal Goat LeBron', rarity: Rarity.GOAT, odds: 5000000, color: 'text-white', glowColor: 'white', image: LEBRON_IMAGE },
          { id: 'lb19', name: 'Universe 23 LeBron', rarity: Rarity.GOAT, odds: 10000000, color: 'text-white', glowColor: 'white', image: LEBRON_IMAGE },
        ];

        const POTIONS = [
          { id: 'p1', name: 'Minor Luck Potion', type: 'luck', multiplier: 10, duration: 60000, price: 500, color: 'from-green-400 to-green-600' },
          { id: 'p2', name: 'Major Luck Potion', type: 'luck', multiplier: 50, duration: 300000, price: 2500, color: 'from-blue-400 to-blue-600' },
          { id: 'p3', name: 'Hyper Luck Potion', type: 'luck', multiplier: 250, duration: 600000, price: 10000, color: 'from-purple-400 to-purple-600' },
          { id: 'p4', name: 'Cash Infusion', type: 'money', multiplier: 10, duration: 120000, price: 1000, color: 'from-yellow-400 to-yellow-600' },
        ];

        const LUCK_UPGRADE_COSTS = [25, 100, 500, 2000, 10000, 50000, 250000, 1000000, 5000000];

        // ==================== COMPONENTS ====================
        const FALLBACK_IMAGE = 'https://media.gettyimages.com/id/1247065095/photo/lebron-james-of-the-los-angeles-lakers-reacts-during-a-game.jpg?s=612x612&w=gi&k=20&c=W07_U7f1Bv0yB8hC1E0yB8hC1E0yB8hC1E0yB8hC1E0=';

        // Cutscene Component
        const Cutscene = ({ player, onComplete }) => {
          const [phase, setPhase] = useState('shaking');
          const config = RARITY_CONFIG[player.rarity];

          const timings = useMemo(() => {
            const odds = player.odds;
            if (odds >= 1000000) return { shaking: 4000, revealing: 8000, total: 14000 };
            if (odds >= 50000) return { shaking: 3000, revealing: 6000, total: 10000 };
            if (odds >= 10000) return { shaking: 2000, revealing: 5000, total: 8000 };
            return { shaking: 1500, revealing: 3500, total: 6000 };
          }, [player.odds]);

          useEffect(() => {
            const t1 = setTimeout(() => setPhase('revealing'), timings.shaking);
            const t2 = setTimeout(() => setPhase('display'), timings.revealing);
            const t3 = setTimeout(onComplete, timings.total);
            return () => {
              clearTimeout(t1);
              clearTimeout(t2);
              clearTimeout(t3);
            };
          }, [onComplete, timings]);

          return React.createElement('div', { className: "fixed inset-0 z-[200] flex items-center justify-center bg-black overflow-hidden" },
            React.createElement('div', { className: `absolute inset-0 transition-all duration-1000 ${phase === 'shaking' ? 'bg-neutral-900 opacity-60' : `${config.bg} opacity-80`}` }),
            
            player.odds >= 50000 && React.createElement('div', { className: "absolute inset-0 pointer-events-none overflow-hidden" },
              React.createElement('div', { className: "absolute top-0 left-1/2 -translate-x-1/2 w-[200%] h-full bg-[repeating-linear-gradient(90deg,transparent,transparent_50px,rgba(255,255,255,0.05)_51px,rgba(255,255,255,0.05)_52px)] transform rotate-45 animate-pulse" })
            ),

            phase === 'shaking' && React.createElement('div', { className: "relative z-10 flex flex-col items-center animate-shake" },
              React.createElement('div', { className: "text-9xl mb-8 drop-shadow-[0_0_30px_rgba(255,255,255,0.5)]" }, 'ðŸ€'),
              React.createElement('h2', { className: "text-6xl font-bungee text-white tracking-widest text-center px-4 drop-shadow-glow" },
                player.odds >= 1000000 ? "THE COSMOS IS ALIGNING..." : "SOMETHING BIG IS COMING..."
              ),
              React.createElement('div', { className: "absolute inset-0 bg-white/30 animate-flash blur-[100px] pointer-events-none" })
            ),

            (phase === 'revealing' || phase === 'display') && React.createElement('div', { className: "relative z-20 flex flex-col items-center" },
              React.createElement('div', { className: `transition-all duration-1000 ${phase === 'revealing' ? 'animate-god-reveal' : 'scale-110'}` },
                React.createElement('div', { className: `relative group w-80 h-[28rem] rounded-3xl p-3 bg-neutral-800 shadow-[0_0_150px_rgba(255,255,255,0.3)] ${config.glow} ring-4 ring-white/10` },
                  React.createElement('div', { className: "w-full h-full rounded-2xl overflow-hidden relative flex flex-col border-8 border-white/20 bg-neutral-900" },
                    React.createElement('div', { className: "h-full w-full relative" },
                      React.createElement('img', {
                        src: player.image,
                        alt: player.name,
                        className: "w-full h-full object-cover"
                      }),
                      React.createElement('div', { className: "absolute inset-0 bg-gradient-to-t from-neutral-950 via-neutral-950/20 to-transparent" })
                    ),
                    React.createElement('div', { className: "absolute bottom-0 left-0 w-full p-6 text-center" },
                      React.createElement('p', { className: `text-lg font-bold uppercase tracking-[0.4em] mb-2 ${config.color} animate-pulse` }, player.rarity),
                      React.createElement('h2', { className: `text-4xl font-bungee leading-tight drop-shadow-[0_4px_8px_rgba(0,0,0,1)] ${config.color}` }, player.name),
                      React.createElement('p', { className: "text-white/70 text-sm mt-3 font-bold uppercase tracking-widest" }, `1 IN ${player.odds.toLocaleString()}`)
                    ),
                    React.createElement('div', { className: "absolute top-0 -left-full w-1/2 h-full bg-gradient-to-r from-transparent via-white/40 to-transparent skew-x-12 animate-flare pointer-events-none" })
                  )
                )
              ),
              phase === 'display' && React.createElement('div', { className: "mt-12 animate-in fade-in slide-in-from-bottom-8 duration-1000 text-center" },
                React.createElement('h3', { className: "text-5xl font-bungee text-yellow-500 animate-bounce drop-shadow-glow" },
                  player.odds >= 1000000 ? "UNIVERSE BROKEN!" : "NEW LEGEND UNLOCKED!"
                ),
                React.createElement('p', { className: "text-white/40 text-sm uppercase font-bold tracking-[0.5em] mt-4" }, 'Preparing your locker...')
              )
            ),

            player.odds >= 10000 && React.createElement('div', { className: "absolute inset-0 pointer-events-none" },
              [...Array(player.odds >= 1000000 ? 50 : 25)].map((_, i) =>
                React.createElement('div', {
                  key: i,
                  className: `absolute rounded-full animate-ping ${player.odds >= 1000000 ? 'bg-cyan-400' : 'bg-white'}`,
                  style: {
                    top: `${Math.random() * 100}%`,
                    left: `${Math.random() * 100}%`,
                    width: `${Math.random() * 8 + 4}px`,
                    height: `${Math.random() * 8 + 4}px`,
                    animationDuration: `${Math.random() * 3 + 1}s`,
                    animationDelay: `${Math.random() * 2}s`
                  }
                })
              )
            )
          );
        };

        // RollDisplay Component
        const RollDisplay = ({ player, isRolling, flavor }) => {
          const handleImageError = (e) => {
            const target = e.target;
            if (target.src !== FALLBACK_IMAGE) {
              target.src = FALLBACK_IMAGE;
            }
          };

          const getFilter = (rarity) => {
            switch (rarity) {
              case Rarity.COMMON: return 'grayscale(100%) brightness(0.8)';
              case Rarity.RARE: return 'hue-rotate(200deg) saturate(2)';
              case Rarity.EPIC: return 'hue-rotate(280deg) saturate(2.5) contrast(1.2)';
              case Rarity.LEGENDARY: return 'sepia(0.5) brightness(1.2) saturate(3) contrast(1.1)';
              case Rarity.MYTHIC: return 'hue-rotate(340deg) saturate(4) contrast(1.5)';
              case Rarity.CELESTIAL: return 'hue-rotate(180deg) brightness(1.8) saturate(1.5) contrast(1.2)';
              case Rarity.DIVINE: return 'hue-rotate(300deg) brightness(1.5) contrast(1.6) saturate(2)';
              case Rarity.GOAT: return 'brightness(1.6) contrast(1.4) saturate(2.5) drop-shadow(0 0 15px white)';
              default: return 'none';
            }
          };

          if (isRolling) {
            return React.createElement('div', { className: "h-96 flex flex-col items-center justify-center" },
              React.createElement('div', { className: "relative w-32 h-32" },
                React.createElement('div', { className: "absolute inset-0 border-8 border-orange-500/20 rounded-full" }),
                React.createElement('div', { className: "absolute inset-0 border-8 border-orange-500 border-t-transparent rounded-full animate-spin" }),
                React.createElement('div', { className: "absolute inset-0 flex items-center justify-center text-4xl animate-bounce" }, 'ðŸ€')
              ),
              React.createElement('p', { className: "mt-8 text-xl font-bungee text-white tracking-widest animate-pulse" }, 'GETTING BUCKETS...')
            );
          }

          if (!player) {
            return React.createElement('div', { className: "h-96 flex items-center justify-center" },
              React.createElement('div', { className: "text-neutral-500 text-lg uppercase tracking-widest opacity-50 flex flex-col items-center gap-4" },
                React.createElement('span', { className: "text-6xl animate-pulse" }, 'ðŸ‘‘'),
                React.createElement('span', null, 'Click Roll')
              )
            );
          }

          const config = RARITY_CONFIG[player.rarity];
          const isRare = player.odds >= 100;

          return React.createElement('div', { className: `flex flex-col items-center animate-in fade-in zoom-in duration-300 ${isRare ? 'animate-shake' : ''}` },
            React.createElement('div', { className: "text-center mb-6" },
              React.createElement('p', { className: `text-sm font-bold uppercase tracking-[0.3em] ${config.color} drop-shadow-lg` },
                player.rarity,
                React.createElement('span', { className: "ml-2 text-white/40" }, `1 in ${player.odds.toLocaleString()}`)
              )
            ),
            React.createElement('div', { className: `relative group w-72 h-96 rounded-3xl p-2 transition-all duration-700 bg-neutral-800 shadow-2xl ${config.glow}` },
              React.createElement('div', { className: "w-full h-full rounded-2xl overflow-hidden relative flex flex-col border-4 border-white/5 bg-neutral-900" },
                React.createElement('div', { className: `absolute top-0 left-0 w-full h-32 opacity-20 ${config.bg}` }),
                React.createElement('div', { className: "h-2/3 w-full relative z-10" },
                  React.createElement('div', { className: "w-full h-full bg-black/40 relative overflow-hidden" },
                    React.createElement('img', {
                      src: player.image,
                      alt: player.name,
                      style: { filter: getFilter(player.rarity) },
                      className: "w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",
                      onError: handleImageError
                    }),
                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-t from-neutral-900 via-transparent to-transparent" })
                  )
                ),
                React.createElement('div', { className: "p-4 flex-1 flex flex-col justify-center text-center z-10" },
                  React.createElement('h2', { className: `text-2xl font-bungee leading-tight mb-1 drop-shadow-md ${config.color}` }, player.name),
                  React.createElement('div', { className: "h-1 w-12 bg-white/20 mx-auto rounded-full" })
                ),
                player.odds >= 1000 && React.createElement('div', { className: "absolute inset-0 pointer-events-none overflow-hidden rounded-2xl z-20" },
                  React.createElement('div', { className: "absolute top-[-50%] left-[-50%] w-[200%] h-[200%] bg-[radial-gradient(circle,rgba(255,255,255,0.15)_0%,transparent_70%)] animate-pulse" })
                )
              )
            ),
            flavor && React.createElement('p', { className: "mt-8 text-center text-neutral-300 italic max-w-sm font-medium bg-neutral-800/80 backdrop-blur px-8 py-4 rounded-2xl border border-white/10 shadow-xl animate-in slide-in-from-bottom-4 duration-500" },
              `"${flavor}"`
            )
          );
        };

        // EquippedDisplay Component
        const EquippedDisplay = ({ equipped }) => {
          const handleImageError = (e) => {
            e.target.src = FALLBACK_IMAGE;
          };

          return React.createElement('div', { className: "flex gap-4 items-center" },
            React.createElement('div', { className: "flex gap-3" },
              [0, 1, 2].map((i) => {
                const player = equipped[i];
                const config = player ? RARITY_CONFIG[player.rarity] : null;

                return React.createElement('div', {
                  key: i,
                  className: `w-14 h-14 md:w-20 md:h-20 rounded-2xl border-2 flex items-center justify-center overflow-hidden transition-all shadow-lg ${
                    player ? `border-current ${config?.color} bg-neutral-800` : 'border-dashed border-white/10 bg-white/5'
                  }`
                },
                  player ? React.createElement('img', {
                    src: player.image,
                    alt: player.name,
                    className: "w-full h-full object-cover",
                    onError: handleImageError
                  }) : React.createElement('span', { className: "text-white/5 text-3xl font-bungee" }, '+')
                );
              })
            ),
            React.createElement('div', { className: "ml-2 bg-white/5 px-4 py-2 rounded-xl border border-white/10" },
              React.createElement('p', { className: "text-[10px] font-bold text-neutral-400 uppercase" }, 'Passive Income'),
              React.createElement('p', { className: "text-lg font-bungee text-green-500 leading-none" }, `+$${(equipped.length * 100 + 10)}/s`)
            )
          );
        };

        // InventoryModal Component
        const InventoryModal = ({ inventory, equipped, onEquip, onClose }) => {
          const sortedInventory = [...inventory].sort((a, b) => b.odds - a.odds);

          return React.createElement('div', { className: "fixed inset-0 z-[100] flex items-center justify-center p-4" },
            React.createElement('div', { className: "absolute inset-0 bg-black/80 backdrop-blur-sm", onClick: onClose }),
            React.createElement('div', { className: "relative bg-neutral-900 w-full max-w-4xl max-h-[80vh] rounded-3xl border border-white/10 flex flex-col overflow-hidden shadow-2xl" },
              React.createElement('div', { className: "p-6 border-b border-white/10 flex justify-between items-center" },
                React.createElement('h2', { className: "text-2xl font-bungee text-white" }, `COLLECTION (${inventory.length})`),
                React.createElement('button', { onClick: onClose, className: "text-neutral-500 hover:text-white text-2xl" }, 'Ã—')
              ),
              React.createElement('div', { className: "flex-1 overflow-y-auto p-6" },
                React.createElement('div', { className: "grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" },
                  sortedInventory.map((player) => {
                    const config = RARITY_CONFIG[player.rarity];
                    const isEquipped = equipped.some(e => e.id === player.id);

                    return React.createElement('div', {
                      key: player.id,
                      className: `relative aspect-[3/4] rounded-xl border p-2 flex flex-col transition-all cursor-pointer group ${
                        isEquipped ? 'border-orange-500 bg-orange-500/10' : 'border-white/5 bg-white/5 hover:border-white/20'
                      }`,
                      onClick: () => onEquip(player)
                    },
                      React.createElement('div', { className: "flex-1 rounded-lg overflow-hidden mb-2" },
                        React.createElement('img', { src: player.image, alt: player.name, className: "w-full h-full object-cover" })
                      ),
                      React.createElement('div', { className: "text-center" },
                        React.createElement('p', { className: `text-[10px] font-bold uppercase truncate ${config.color}` }, player.rarity),
                        React.createElement('p', { className: "text-xs font-bold text-white truncate px-1" }, player.name)
                      ),
                      isEquipped && React.createElement('div', { className: "absolute top-2 right-2 bg-orange-500 text-[8px] font-bold px-1.5 py-0.5 rounded shadow-lg" }, 'EQUIPPED')
                    );
                  })
                ),
                inventory.length === 0 && React.createElement('div', { className: "flex flex-col items-center justify-center py-20 text-neutral-500 uppercase tracking-widest" },
                  React.createElement('p', null, 'Nothing in your locker yet'),
                  React.createElement('p', { className: "text-xs mt-2" }, 'Go roll some legends!')
                )
              )
            )
          );
        };

        // ShopModal Component
        const ShopModal = ({ coins, luckLevel, onUpgradeLuck, onBuyPotion, onClose }) => {
          const nextLuckCost = LUCK_UPGRADE_COSTS[luckLevel];
          const canAffordLuck = nextLuckCost !== undefined && coins >= nextLuckCost;

          return React.createElement('div', { className: "fixed inset-0 z-[100] flex items-center justify-center p-4" },
            React.createElement('div', { className: "absolute inset-0 bg-black/80 backdrop-blur-sm", onClick: onClose }),
            React.createElement('div', { className: "relative bg-neutral-900 w-full max-w-2xl rounded-3xl border border-white/10 flex flex-col overflow-hidden shadow-2xl" },
              React.createElement('div', { className: "p-6 border-b border-white/10 flex justify-between items-center bg-white/5" },
                React.createElement('div', null,
                  React.createElement('h2', { className: "text-2xl font-bungee text-white" }, 'THE PRO SHOP'),
                  React.createElement('p', { className: "text-sm text-yellow-500 font-bold" }, `Balance: $${coins.toLocaleString()}`)
                ),
                React.createElement('button', { onClick: onClose, className: "text-neutral-500 hover:text-white text-2xl" }, 'Ã—')
              ),
              React.createElement('div', { className: "p-6 space-y-8 overflow-y-auto max-h-[70vh]" },
                React.createElement('div', null,
                  React.createElement('h3', { className: "text-sm font-bold text-neutral-400 uppercase tracking-widest mb-4" }, 'Permanent Upgrades'),
                  React.createElement('div', { className: "bg-white/5 border border-white/10 p-4 rounded-2xl flex items-center justify-between group" },
                    React.createElement('div', { className: "flex gap-4 items-center" },
                      React.createElement('div', { className: "w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center text-green-500 text-2xl" }, 'ðŸ€'),
                      React.createElement('div', null,
                        React.createElement('p', { className: "font-bold text-white" }, `Luck Mastery (Level ${luckLevel})`),
                        React.createElement('p', { className: "text-xs text-neutral-400" }, 'Increases permanent luck by +0.5x')
                      )
                    ),
                    React.createElement('button', {
                      onClick: onUpgradeLuck,
                      disabled: !canAffordLuck,
                      className: `px-6 py-3 rounded-xl font-bold transition-all ${
                        canAffordLuck
                          ? 'bg-orange-600 hover:bg-orange-500 text-white'
                          : 'bg-neutral-800 text-neutral-500 cursor-not-allowed'
                      }`
                    }, nextLuckCost !== undefined ? `$${nextLuckCost.toLocaleString()}` : 'MAX')
                  )
                ),
                React.createElement('div', null,
                  React.createElement('h3', { className: "text-sm font-bold text-neutral-400 uppercase tracking-widest mb-4" }, 'Temporary Boosts'),
                  React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 gap-4" },
                    POTIONS.map(potion =>
                      React.createElement('div', { key: potion.id, className: "bg-white/5 border border-white/10 p-4 rounded-2xl flex flex-col gap-4" },
                        React.createElement('div', { className: "flex items-center gap-3" },
                          React.createElement('div', { className: `w-10 h-10 rounded-lg bg-gradient-to-br ${potion.color} flex items-center justify-center text-xl shadow-lg shadow-black/40` },
                            potion.type === 'luck' ? 'ðŸ”®' : 'ðŸ’°'
                          ),
                          React.createElement('div', null,
                            React.createElement('p', { className: "font-bold text-white text-sm" }, potion.name),
                            React.createElement('p', { className: "text-[10px] text-neutral-400" }, `${Math.floor(potion.duration / 60000)}m Duration`)
                          )
                        ),
                        React.createElement('div', { className: "flex justify-between items-center mt-2" },
                          React.createElement('span', { className: "text-yellow-500 font-bold text-sm" }, `$${potion.price.toLocaleString()}`),
                          React.createElement('button', {
                            onClick: () => onBuyPotion(potion),
                            disabled: coins < potion.price,
                            className: `px-4 py-1.5 rounded-lg text-xs font-bold transition-all ${
                              coins >= potion.price
                                ? 'bg-white/10 hover:bg-white/20 text-white'
                                : 'bg-neutral-800 text-neutral-500 cursor-not-allowed'
                            }`
                          }, 'Buy')
                        )
                      )
                    )
                  )
                )
              )
            )
          );
        };

        // Main App Component
        const App = () => {
          const [stats, setStats] = useState(() => {
            const saved = localStorage.getItem('lebron-rng-stats-v3');
            if (saved) return JSON.parse(saved);
            return {
              coins: 0,
              luckMultiplier: 1,
              totalRolls: 0,
              inventory: [],
              equipped: [],
              luckUpgrades: 0,
              activePotions: { luck: 0, money: 0 }
            };
          });

          const [lastRoll, setLastRoll] = useState(null);
          const [isRolling, setIsRolling] = useState(false);
          const [hasUnclaimedRoll, setHasUnclaimedRoll] = useState(false);
          const [autoRoll, setAutoRoll] = useState(false);
          const [activeModal, setActiveModal] = useState(null);
          const [cutscenePlayer, setCutscenePlayer] = useState(null);
          const [currentFlavor, setCurrentFlavor] = useState("");

          const rollRef = useRef(isRolling);
          rollRef.current = isRolling;

          // Persist stats
          useEffect(() => {
            localStorage.setItem('lebron-rng-stats-v3', JSON.stringify(stats));
          }, [stats]);

          // Periodic earnings
          useEffect(() => {
            const interval = setInterval(() => {
              setStats(prev => {
                const moneyMult = prev.activePotions.money > Date.now() ? 10 : 1;
                const passiveIncome = (prev.equipped.length * 100 + 10) * moneyMult;
                return { ...prev, coins: prev.coins + passiveIncome };
              });
            }, 1000);
            return () => clearInterval(interval);
          }, []);

          const getCurrentLuck = useCallback(() => {
            let baseLuck = 1 + (stats.luckUpgrades * 5);
            let potionMultiplier = 1;
            if (stats.activePotions.luck > Date.now()) {
              potionMultiplier = 15;
            }
            return baseLuck * potionMultiplier;
          }, [stats.luckUpgrades, stats.activePotions.luck]);

          const performRoll = useCallback(async () => {
            if (isRolling || cutscenePlayer || hasUnclaimedRoll) return;
            setIsRolling(true);
            setCurrentFlavor("");

            const luck = getCurrentLuck();
            const sortedPlayers = [...PLAYERS].sort((a, b) => b.odds - a.odds);
            let selected = PLAYERS[0];

            for (const player of sortedPlayers) {
              const chance = 1 / (player.odds / luck);
              if (Math.random() < chance) {
                selected = player;
                break;
              }
            }

            setTimeout(async () => {
              setLastRoll(selected);
              
              const isRare = selected.odds >= 1000;

              if (isRare) {
                setCutscenePlayer(selected);
              } else {
                setHasUnclaimedRoll(true);
              }

              if (isRare) {
                const flavors = [
                  "The courts tremble at your luck!",
                  "A legendary pull!",
                  "This is going to be remembered!",
                  "Absolutely insane!",
                  "The king has arrived!",
                  "Witness greatness!"
                ];
                setCurrentFlavor(flavors[Math.floor(Math.random() * flavors.length)]);
              }

              setStats(prev => {
                const exists = prev.inventory.some(p => p.id === selected.id);
                const newInventory = exists ? prev.inventory : [...prev.inventory, selected];
                return {
                  ...prev,
                  totalRolls: prev.totalRolls + 1,
                  inventory: newInventory
                };
              });

              setIsRolling(false);
            }, 250);
          }, [isRolling, cutscenePlayer, hasUnclaimedRoll, getCurrentLuck]);

          const handleCutsceneComplete = () => {
            setCutscenePlayer(null);
            setHasUnclaimedRoll(true);
          };

          const claimRoll = () => {
            setHasUnclaimedRoll(false);
          };

          useEffect(() => {
            let timer;
            if (autoRoll && !isRolling && !cutscenePlayer && !hasUnclaimedRoll) {
              timer = setTimeout(() => {
                performRoll();
              }, 300);
            }
            return () => clearTimeout(timer);
          }, [autoRoll, isRolling, cutscenePlayer, hasUnclaimedRoll, performRoll]);

          const buyUpgrade = () => {
            const cost = LUCK_UPGRADE_COSTS[stats.luckUpgrades];
            if (stats.coins >= cost && stats.luckUpgrades < LUCK_UPGRADE_COSTS.length) {
              setStats(prev => ({
                ...prev,
                coins: prev.coins - cost,
                luckUpgrades: prev.luckUpgrades + 1
              }));
            }
          };

          const buyPotion = (potion) => {
            if (stats.coins >= potion.price) {
              setStats(prev => ({
                ...prev,
                coins: prev.coins - potion.price,
                activePotions: {
                  ...prev.activePotions,
                  [potion.type]: Date.now() + potion.duration
                }
              }));
            }
          };

          const equipPlayer = (player) => {
            setStats(prev => {
              const isEquipped = prev.equipped.some(p => p.id === player.id);
              if (isEquipped) {
                return { ...prev, equipped: prev.equipped.filter(p => p.id !== player.id) };
              }
              if (prev.equipped.length >= 3) return prev;
              return { ...prev, equipped: [...prev.equipped, player] };
            });
          };

          return React.createElement('div', { className: "min-h-screen bg-neutral-950 flex flex-col items-center p-4 relative overflow-hidden" },
            cutscenePlayer && React.createElement(Cutscene, { player: cutscenePlayer, onComplete: handleCutsceneComplete }),
            React.createElement('div', { className: "absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-500/10 rounded-full blur-[120px]" }),
            React.createElement('div', { className: "absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-orange-500/10 rounded-full blur-[120px]" }),
            React.createElement('div', { className: "w-full max-w-4xl flex justify-between items-start z-10" },
              React.createElement('div', { className: "bg-black/40 backdrop-blur-md p-4 rounded-xl border border-white/10" },
                React.createElement('h1', { className: "text-3xl font-bungee text-orange-500 tracking-tight text-shadow-glow" }, 'LEBRON RNG'),
                React.createElement('p', { className: "text-sm text-neutral-400" }, 'Rolls: ', React.createElement('span', { className: "text-white" }, stats.totalRolls.toLocaleString())),
                React.createElement('p', { className: "text-sm text-neutral-400" }, 'Luck: ', React.createElement('span', { className: "text-green-400" }, `x${getCurrentLuck().toFixed(1)}`))
              ),
              React.createElement('div', { className: "flex flex-col items-end gap-2" },
                React.createElement('div', { className: "bg-black/40 backdrop-blur-md p-4 rounded-xl border border-white/10 flex items-center gap-3" },
                  React.createElement('div', { className: "text-right" },
                    React.createElement('p', { className: "text-xs text-neutral-400 uppercase font-bold" }, 'Balance'),
                    React.createElement('p', { className: "text-2xl font-bungee text-yellow-500" }, `$${stats.coins.toLocaleString()}`)
                  ),
                  React.createElement('div', { className: "w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center text-black font-bold" }, '$')
                ),
                React.createElement('div', { className: "flex gap-2" },
                  stats.activePotions.luck > Date.now() && React.createElement('div', { className: "bg-purple-900/50 text-purple-200 text-[10px] px-2 py-1 rounded-full border border-purple-500/50 animate-pulse" }, 'LUCK BOOST'),
                  stats.activePotions.money > Date.now() && React.createElement('div', { className: "bg-yellow-900/50 text-yellow-200 text-[10px] px-2 py-1 rounded-full border border-yellow-500/50 animate-pulse" }, 'CASH BOOST')
                )
              )
            ),
            React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center w-full max-w-2xl z-10 py-8" },
              React.createElement(RollDisplay, { player: lastRoll, isRolling: isRolling, flavor: currentFlavor }),
              React.createElement('div', { className: "mt-8 flex flex-col items-center gap-6 w-full h-24" },
                hasUnclaimedRoll && React.createElement('button', {
                  onClick: claimRoll,
                  className: "px-12 py-4 rounded-2xl bg-green-600 hover:bg-green-500 text-white font-bungee text-xl transition-all shadow-xl shadow-green-500/30 animate-in slide-in-from-top-4 duration-300 ring-4 ring-green-400/20 active:scale-95"
                }, 'CLAIM RESULTS')
              ),
              React.createElement('div', { className: "mt-4 flex flex-col items-center gap-6 w-full" },
                React.createElement('div', { className: "relative" },
                  React.createElement('button', {
                    onClick: performRoll,
                    disabled: isRolling || !!cutscenePlayer || hasUnclaimedRoll,
                    className: `w-40 h-40 rounded-full font-bungee text-2xl transition-all duration-300 shadow-2xl relative overflow-hidden ${
                      (isRolling || hasUnclaimedRoll || !!cutscenePlayer)
                        ? 'bg-neutral-800 scale-95 cursor-not-allowed opacity-50 shadow-none'
                        : 'bg-orange-600 hover:bg-orange-500 hover:scale-110 active:scale-90 shadow-orange-500/40'
                    }`
                  },
                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent" }),
                    isRolling ? '...' : ((hasUnclaimedRoll || !!cutscenePlayer) ? 'LOCKED' : 'ROLL')
                  ),
                  (hasUnclaimedRoll || !!cutscenePlayer) && React.createElement('div', { className: "absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-lg animate-bounce" },
                    !!cutscenePlayer ? 'REVEALING...' : 'CLAIM FIRST!'
                  )
                ),
                React.createElement('div', { className: "flex gap-4" },
                  React.createElement('button', {
                    onClick: () => setAutoRoll(!autoRoll),
                    className: `px-8 py-3 rounded-full font-bold border-2 transition-all ${
                      autoRoll ? 'bg-red-500/20 border-red-500 text-red-500' : 'bg-white/5 border-white/20 text-white hover:bg-white/10'
                    }`
                  }, autoRoll ? 'STOP AUTO' : 'AUTO ROLL')
                )
              )
            ),
            React.createElement('div', { className: "w-full max-w-4xl z-20 flex flex-col md:flex-row justify-between items-center gap-4 bg-black/60 backdrop-blur-xl p-4 rounded-2xl border border-white/10 mt-auto sticky bottom-4" },
              React.createElement(EquippedDisplay, { equipped: stats.equipped }),
              React.createElement('div', { className: "flex gap-3" },
                React.createElement('button', { onClick: () => setActiveModal('inventory'), className: "flex flex-col items-center px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 transition-colors" },
                  React.createElement('span', { className: "text-xs text-neutral-400" }, 'Locker'),
                  React.createElement('span', { className: "font-bold text-lg" }, stats.inventory.length)
                ),
                React.createElement('button', { onClick: () => setActiveModal('shop'), className: "flex flex-col items-center px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 transition-colors" },
                  React.createElement('span', { className: "text-xs text-neutral-400" }, 'Shop'),
                  React.createElement('span', { className: "font-bold text-lg" }, 'ðŸª')
                )
              )
            ),
            activeModal === 'inventory' && React.createElement(InventoryModal, { inventory: stats.inventory, equipped: stats.equipped, onEquip: equipPlayer, onClose: () => setActiveModal(null) }),
            activeModal === 'shop' && React.createElement(ShopModal, { coins: stats.coins, luckLevel: stats.luckUpgrades, onUpgradeLuck: buyUpgrade, onBuyPotion: buyPotion, onClose: () => setActiveModal(null) })
          );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
